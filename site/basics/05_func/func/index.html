



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="jusk9527">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.1">
    
    
      
        <title>Go 函数 - Let's Scrapy!</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="black" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#go" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Let's Scrapy!" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Let's Scrapy!
            </span>
            <span class="md-header-nav__topic">
              
                Go 函数
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/jusk9527/LetsScrapy/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LetsScrapy
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Let's Scrapy!" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Let's Scrapy!
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/jusk9527/LetsScrapy/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LetsScrapy
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="简介" class="md-nav__link">
      简介
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Go基础
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Go基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../00_hello_go/hello_go/" title="Scrapy简单介绍" class="md-nav__link">
      Scrapy简单介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../01_go_basic_types/basic_types/" title="Scrapy spider 定制爬虫" class="md-nav__link">
      Scrapy spider 定制爬虫
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../02_go_array_and_slice/array_and_slice/" title="Scrapy 通用爬虫" class="md-nav__link">
      Scrapy 通用爬虫
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../03_map/map/" title="Go 映射" class="md-nav__link">
      Go 映射
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../04_go_control_flow/go_procedural/" title="Go 控制流语句" class="md-nav__link">
      Go 控制流语句
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Go 函数
      </label>
    
    <a href="./" title="Go 函数" class="md-nav__link md-nav__link--active">
      Go 函数
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="函数介绍" class="md-nav__link">
    函数介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="如何定义一个函数" class="md-nav__link">
    如何定义一个函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="泛型" class="md-nav__link">
    泛型
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="默认参数" class="md-nav__link">
    默认参数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="函数的传参" class="md-nav__link">
    函数的传参
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="传递指针" class="md-nav__link">
    传递指针
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" title="匿名函数" class="md-nav__link">
    匿名函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" title="函数类型" class="md-nav__link">
    函数类型
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" title="高阶函数" class="md-nav__link">
    高阶函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" title="闭包" class="md-nav__link">
    闭包
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="递归函数" class="md-nav__link">
    递归函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" title="参考：" class="md-nav__link">
    参考：
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../06_error/error/" title="Go 错误处理" class="md-nav__link">
      Go 错误处理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../07_oop/oop/" title="Go 面向对象编程" class="md-nav__link">
      Go 面向对象编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../08_struct/struct/" title="Go struct" class="md-nav__link">
      Go struct
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../09_interface/interface/" title="Go 接口" class="md-nav__link">
      Go 接口
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../10_goroutine/goroutine/" title="Goroutine 初探" class="md-nav__link">
      Goroutine 初探
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="函数介绍" class="md-nav__link">
    函数介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="如何定义一个函数" class="md-nav__link">
    如何定义一个函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="泛型" class="md-nav__link">
    泛型
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="默认参数" class="md-nav__link">
    默认参数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="函数的传参" class="md-nav__link">
    函数的传参
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="传递指针" class="md-nav__link">
    传递指针
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" title="匿名函数" class="md-nav__link">
    匿名函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" title="函数类型" class="md-nav__link">
    函数类型
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" title="高阶函数" class="md-nav__link">
    高阶函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" title="闭包" class="md-nav__link">
    闭包
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="递归函数" class="md-nav__link">
    递归函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" title="参考：" class="md-nav__link">
    参考：
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jusk9527/LetsScrapy/edit/master/docs/basics/05_func/func.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="go">初探 go 函数<a class="headerlink" href="#go" title="Permanent link">&para;</a></h1>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>“Go is not meant to innovate programming theory. It’s meant to innovate programming practice.” – Samuel Tesla</p>
</div>
<h2 id="_1">函数介绍<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>函数可以说是开发大型软件的基石，也是封装代码的基本单位。在一些比较老的不支持 oop 的编程语言中，正是一个个函数构建起来大型软件。
其实之前的代码中已经简单使用过函数，比如我们针对每一种语法特性都写了一个叫做 <code>func testXXX</code> 的函数来在 main
函数里调用看执行结果。</p>
<p>本章来分享一些业务开中常用的 go 函数的语法特性帮助你快速上手，学会函数之后就可以开始实现逻辑封装了。</p>
<h2 id="_2">如何定义一个函数<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>go 定义一个函数比较简单，语法如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// optionalParameters 是 (param1 type1, param2 type2 ...) 这种形式</span>
<span class="kd">func</span> <span class="nx">functionName</span><span class="p">(</span><span class="nx">optionalParameters</span><span class="p">)</span> <span class="nx">optionalReturnType</span> <span class="p">{</span>
  <span class="nx">body</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>来看一个非常简单的函数，计算两个数字之和：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">sum0</span><span class="p">(</span><span class="nx">a</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>是不是很简单，有个小技巧就是如果多个参数类型一致，可以只写一个类型声明，比如：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">sum1</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>我们甚至还可以给返回值命名，这个时候需要通过赋值的方式来更新结果，而且 return 可以不用带返回值</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">sum2</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="nx">res</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span> <span class="p">=</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
    <span class="k">return</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>go 还支持可变参数，在 python 里我们知道使用的是 <code>*args</code>，在 go 里边使用三个省略号来实现，
比如想要计算 n 个 int 数字之和，可以这么写：(注意可变参数其实被包装成了一个 slice)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">sum3</span><span class="p">(</span><span class="nx">init</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">vals</span> <span class="o">...</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">sum</span> <span class="o">:=</span> <span class="nx">init</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">val</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">vals</span> <span class="p">{</span> <span class="c1">// vals is []int</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">val</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">sum</span>
<span class="p">}</span>
<span class="c1">// fmt.Println(sum3(0, 1, 2, 3))</span>
<span class="c1">// fmt.Println(sum3(0, []int{1,2,3}...))  // 还可以解包一个 slice 来作为参数传入，给一个 slice 加上三个省略号</span>
</code></pre></div>
</td></tr></table>

<p>再进一步，函数还可以返回多个值，这个相比 c 来说非常方便，比如除了 sum 之外我们再返回一个可变参数的个数：
(其实 go 最后一个参数经常用来返回错误类型，这个之后讨论错误处理的时候再涉及)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">sum4</span><span class="p">(</span><span class="nx">init</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">vals</span> <span class="o">...</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sum</span> <span class="o">:=</span> <span class="nx">init</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">vals</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">vals</span><span class="p">))</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">val</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">vals</span> <span class="p">{</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">val</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">sum</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">vals</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>这大概就是函数定义的常见方式，虽然它们形式上很简单，但其实已经包含了很多基本的要素，其他复杂的函数无非是更多的参数，
更加复杂的参数或者返回值类型而已。</p>
<h2 id="_3">泛型<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>先卖个关子，go 目前为止还没有直接提供泛型支持，我们可以使用空接口 interface{} 来实现，之后讲到接口的时候我们再来看如何实现。</p>
<h2 id="_4">默认参数<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>很遗憾，go 开发者老顽固们拒绝支持默认参数，不过倒是有一些比较 trick 的方法来实现。
一种是通过传递零值并且代码里判断是否是零值来实现，另一种是通过传递一个结构体来实现(结构体章节再讲)。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// https://stackoverflow.com/questions/19612449/default-value-in-gos-method</span>
<span class="c1">// 可以通过传递零值或者 nil 的方式来判断。</span>
<span class="c1">// Both parameters are optional, use empty string for default value</span>
<span class="kd">func</span> <span class="nx">Concat1</span><span class="p">(</span><span class="nx">a</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">a</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="p">=</span> <span class="s">&quot;default-a&quot;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">b</span> <span class="p">=</span> <span class="mi">5</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s%d&quot;</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h2 id="_5">函数的传参<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>每当学习一门新语言的时候，我都会留意下函数的传值问题，究竟是值传递(深拷贝参数的值)还是引用传递(传入指针)。
这两种参数传递方式最大的区别就是我们是否可以修改传入参数的值。 先来看一个小例子，尝试传入一个字符串然后修改它，看看是否起作用：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">changeStr</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="p">=</span> <span class="s">&quot;hehe&quot;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="o">:=</span> <span class="s">&quot;lao wang&quot;</span>
    <span class="nx">changeStr</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="c1">// 打印出来还是 &quot;lao wang&quot;，没有修改成功，似乎是『值传递』</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>看起来似乎是值传递，并没有修改传入的值。好，如果你那么认为，那再试试如果我们传递一个 map 作为参数呢？</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">changeMap</span><span class="p">(</span><span class="nx">m</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">[</span><span class="s">&quot;王八&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;绿豆&quot;</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;lao wang&quot;</span><span class="p">}</span>
    <span class="nx">changeMap</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="c1">// map[name:lao wang 王八:绿豆], 似乎又可以修改了，函数里的修改起作用了</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>你会发现我们可以修改 map 的值。其实记住以下这些你就知道什么时候可以修改传入的参数了：</p>
<ul>
<li>内置类型：数值类型、字符串、布尔类型、数组。传递的是副本 (所以一般不用数组啦)，会拷贝原始值，无法修改</li>
<li>引用类型: 切片、映射、通道、接口和函数类型。通过复制传递应用类型值的副本，本质上就是共享底层数据结构。可以修改</li>
</ul>
<p>这里其实 map/slice 等也是传递的副本，为啥它们就可以修改呢？我们以 slice
举例，它的内部实现其实是这样的，底层实现包含一个指向数组的指针(ptr), 一个长度 len 和容量 cap
，传参的时候实际上是 slice 这个结构体的拷贝(只有三个元素而不是copy所有的底层数组里的值)，所以复制很轻量，而且通过底层的指针也可以实现修改。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// https://golang.org/src/runtime/slice.go</span>
<span class="kd">type</span> <span class="nx">slice</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">array</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span>
    <span class="nx">len</span>   <span class="kt">int</span>
    <span class="nx">cap</span>   <span class="kt">int</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p><img alt="" src="../slice-internal.png" /></p>
<p>所以我们看到go 里边所有的函数参数都是值拷贝，只不过对于一些复合结构因为复制的结构体里包含指针，所以可以修改它的底层结构。</p>
<h2 id="_6">传递指针<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>如果你学过c/c++，你可能会遇到各种费解的指针操作。go 也有指针，但是 go
里边大大简化和限制了指针的使用，所以只要你知道指针的基本概念就可以应付几乎所有场景了。
后文讲结构体的时候，我们在来看下如何传递通过传递结构体指针来修改一个结构体，你会发现大部分指针的使用场景都是针对复杂的结构体。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">changeString</span><span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// go 同样使用 * 声明指针类型</span>
    <span class="o">*</span><span class="nx">s</span> <span class="p">=</span> <span class="s">&quot;new lao wang&quot;</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="o">:=</span> <span class="s">&quot;lao wang&quot;</span>
    <span class="nx">changeString</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s</span><span class="p">)</span> <span class="c1">// go 和 c 一样使用 &amp; 作为取地址操作符</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h2 id="_7">匿名函数<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>上面我们看到了 go 函数的常见定义方式，go 中我们也可以使用匿名函数，经常用在一些临时的小函数中，比如下边这个例子，
定义一个匿名函数并且打印传进去的字符串：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">testAnonymousFunc</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">func</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
    <span class="p">}(</span><span class="s">&quot;hehe&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h2 id="_8">函数类型<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>go 里边函数其实也是『一等公民』，函数本身也是一种类型，所以我们可以定义一个函数然后赋值给一个变量，比如:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">testFuncType</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">myPrint</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">}</span>
    <span class="nx">myPrint</span><span class="p">(</span><span class="s">&quot;hello go&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>如此一来 go 的函数实际上会非常灵活，比如我们可以定一个 map 值为函数的映射：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">testMapFunc</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">funcMap</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
        <span class="s">&quot;add&quot;</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="p">},</span>
        <span class="s">&quot;sub&quot;</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span> <span class="p">},</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">funcMap</span><span class="p">[</span><span class="s">&quot;add&quot;</span><span class="p">](</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">funcMap</span><span class="p">[</span><span class="s">&quot;sub&quot;</span><span class="p">](</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>甚至还可以作为函数的参数传递进去，比如这个例子：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Double</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">n</span> <span class="o">*</span> <span class="mi">2</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">Apply</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">f</span> <span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// f 的类型是 &quot;func(int) int&quot;</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">funcAsParam</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Apply</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">Double</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>可以看到 go 的函数使用起来是非常灵活的，有些写法可能你在动态语言中才会经常看到。</p>
<h2 id="_9">高阶函数<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<p>其实所谓高阶函数就是将一个或者多个其他函数作为自己的参数，并在函数体里调用它们。上边的例子已经演示到啦，
这里我们再来写一个简单的示例，在很多语言中都可以见到的谓词函数。
我们经常想从一个数组里边获取我们需要的一组数据，就可以这么写，从一个切片中获取所有奇数(odd number):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">FilterIntSlice</span><span class="p">(</span><span class="nx">intVals</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">predicate</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
    <span class="nx">res</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">val</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">intVals</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">predicate</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">res</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ints</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">}</span>
    <span class="nx">isOdd</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">}</span> <span class="c1">// 是奇数</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">FilterIntSlice</span><span class="p">(</span><span class="nx">ints</span><span class="p">,</span> <span class="nx">isOdd</span><span class="p">))</span>      <span class="c1">// [1 3 5]</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>是不是很简单，同样我们还可以获取所有的偶数，或者满足某些条件的数字。留给读者作为小练习</p>
<h2 id="_10">闭包<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>很多语言都有闭包的概念， 所谓闭包就是一个函数“捕获”了和它在同一作用域的其他常量和变量。
当闭包被调用的时候，不管在程序什么地方调用，闭包能够使用这些常量或者变量，并且只要闭包还在使用它，这些变量就不会销毁，一直存在。
上文中提到的匿名函数其实就是闭包。来看一个简单的示例：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// 闭包示例</span>
<span class="kd">func</span> <span class="nx">testClosure</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">suffix</span> <span class="o">:=</span> <span class="s">&quot;.go&quot;</span>
    <span class="nx">addSuffix</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">name</span> <span class="o">+</span> <span class="nx">suffix</span> <span class="c1">// 这里使用到了 suffix 这个变量，所以 addSuffix 就是一个闭包</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">addSuffix</span><span class="p">(</span><span class="s">&quot;hello_world&quot;</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>之后再讲到 goroutine 的时候，我们会看到一个 for 循环里使用闭包的坑。</p>
<h2 id="_11">递归函数<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<p>如果你学习过其他语言，一定知道递归，就是自己调用自己的函数，go 也是支持递归函数的。比如我们经常看到的斐波那契数：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">n</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">n</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>递归需要注意的一点就是一定要有一个递归出口，防止无限递归导致栈溢出(stackoverflow)</p>
</div>
<h2 id="_12">参考：<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://blog.golang.org/go-slices-usage-and-internals">Go Slices: usage and internals</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../04_go_control_flow/go_procedural/" title="Go 控制流语句" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Go 控制流语句
              </span>
            </div>
          </a>
        
        
          <a href="../../06_error/error/" title="Go 错误处理" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Go 错误处理
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 - 2020 PegasusWang
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/jusk9527" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c648116f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>